# projodo - TUI ToDoアプリ（MVP）要件定義

## 1. 目的

端末上でキーボード中心にToDoを素早く追加・確認・編集できるアプリを作る。データは todo.txt 形式の1ファイルに保存し、他ツールとも併用できる状態を保つ。

## 2. 対象ユーザー像

* マウス操作を避けたい
* 端末で軽くToDoを扱いたい
* todo.txt での運用（テキストベース）を崩したくない

## 3. スコープ

### 3.1 MVPでやること（In Scope）

* todo.txt ファイルを読み込み、タスク一覧を表示できる
* +project を左サイドバーに一覧表示し、選択したprojectで中央のタスク一覧を絞り込める
* タスクの追加ができる（最低限：本文＋選択中project自動付与）
* タスクの編集ができる（最低限：本文、完了/未完了）
* タスクの完了/未完了をトグルできる（x の付け外し）
* 文字列検索で絞り込みできる（本文、+project、@context、key:value を対象）
* 保存は todo.txt へ反映される（1行=1タスクのまま）

### 3.2 MVPではやらないこと（Out of Scope）

* project一覧やcontext一覧の手動編集・ピン留め・非表示・統合
* 複数ファイル管理、同期、クラウド保存
* リマインダー通知、期限の自動アラート
* 高度なソート（due優先など）やビューのカスタマイズ
* 定期タスク、サブタスク、依存関係

## 4. 機能要件

### 4.1 起動・ファイル入出力

* 起動時に todo.txt を読み込む
* 終了時または明示保存で todo.txt に書き戻す
* ファイルパスは起動引数で指定できる（未指定時はカレントの ./todo.txt を既定）

### 4.2 画面構成

* 左サイドバー：+project 一覧
* 中央：選択中projectに属するタスク一覧
* 下部：ヘルプ/ステータス（キー操作、検索状態など）

### 4.3 絞り込み

* project選択で絞り込み
* 追加で検索語（/）を入力して、一覧をさらに絞り込み
* 検索対象は、行全体の文字列（生テキスト）を基本とする

### 4.4 タスク追加

* キー操作で追加フォームを開く
* 入力項目（MVP）

  * 本文（必須）
* 自動付与

  * 選択中の +project を末尾に付与（既に本文に含まれていれば重複しない）
* 保存時に1行としてtodo.txtへ追記

### 4.5 タスク編集

* 選択中タスクを編集フォームで編集
* 編集項目（MVP）

  * 本文
  * 完了/未完了
* 完了にした場合

  * 行頭に `x ` を付ける
  * 完了日・作成日の自動管理はMVPでは行わず、行の先頭にxを付ける/外すのみを基本とする

### 4.6 完了トグル

* 選択中タスクに対してワンキーで完了/未完了を切り替える
* MVPの変換ルール

  * 未完了 → 完了：行頭に `x ` を付ける
  * 完了 → 未完了：行頭の `x ` を外す

## 5. 非機能要件

### 5.1 可搬性

* 端末（Windows/macOS/Linux）で動作する

### 5.2 データ互換性

* todo.txt の1行=1タスクを維持する
* 不明な書式（拡張表現など）が混ざっても、可能な限り原文を壊さない

### 5.3 操作性

* キーボードのみで主要操作が完結する
* 画面遷移は少なく、一覧中心で操作できる

## 6. キーバインド案（MVP）

* ↑/↓：選択移動
* Tab：サイドバー/一覧のフォーカス切替
* /：検索入力の開始
* Esc：検索解除、モーダルキャンセル
* a：タスク追加
* e または Enter：タスク編集
* Space：完了トグル
* s：保存（任意。MVPでは自動保存でも可）
* q：終了

## 7. データモデル（内部表現）

* raw_line: 元の1行文字列
* is_done: 行頭が `x ` かどうか
* projects: `+...` の抽出結果（表示/絞り込み用）
* contexts: `@...` の抽出結果（検索用）
* kv: `key:value` の抽出結果（検索用）
* body: 上記トークンを除いた本文（表示/編集の中心）

## 8. パースと保存の方針（MVP）

* 表示・検索のために軽量にトークン抽出する
* 保存は原則として raw_line をベースに最小差分で更新する

  * 本文編集：本文部分のみ差し替え（+project 等は維持）
  * 完了トグル：先頭の `x ` の付け外し

## 9. 受け入れ条件（MVP）

* todo.txt を読み込んで、project一覧とタスク一覧が表示される
* projectを選ぶと中央の一覧が切り替わる
* a で追加し、保存後に todo.txt に行が増えている
* e/Enter で本文を編集し、保存後に todo.txt の該当行が更新されている
* Space で完了/未完了が切り替わり、todo.txt の行頭に x が付け外しされる
* / で検索でき、Escで解除できる
